/*! Boxer 2016-09-06 */
"use strict";var Boxer=function(a,b,c,d){this._$$name=a||"",b&&this._$$register(this),this._$$dataContainer=new Map,this._$$eventListeners={_$$global:[]},this._$$immutable=this._$$booleanOrTrue(c),this._$$frozen=!1;var e=this._$$booleanOrTrue(d),f=this._$$isProxySupported();if(this._$$protected=f&&e,this._$$protected)return this._$$protect()};Boxer.prototype._$$boxerStore={nextFreeId:0,boxers:{}},Boxer.prototype.$getBoxerById=function(a){return this._$$boxerStore.boxers[a]||null},Boxer.prototype._$$register=function(a){var b="number"==typeof this._$$registeredId;return b?(console.error("Boxer already registered with id: "+this._$$registeredId,{boxer:this}),console.trace()):(this._$$boxerStore.boxers[this._$$boxerStore.nextFreeId]=a,this._$$registeredId=this._$$boxerStore.nextFreeId,this._$$boxerStore.nextFreeId++),this},Boxer.prototype.$getName=function(){return this._$$name},Boxer.prototype.$register=function(){return this._$$register(this),this},Boxer.prototype.$getId=function(){return this._$$registeredId||null},Boxer.prototype.$setName=function(a,b){return""===this._$$name?(this._$$name=a,b&&this._$$register(this)):console.log("Boxer cannot be renamed",{boxer:this}),this},Boxer.prototype._$$booleanOrTrue=function(a){return"boolean"!=typeof a||a},Boxer.prototype.$freeze=function(){return this._$$frozen=!0,this},Boxer.prototype.$unfreeze=function(){return this._$$frozen=!1,this},Boxer.prototype.$isFrozen=function(){return this._$$frozen},Boxer.prototype._$$isProxySupported=function(){return"undefined"!=typeof Proxy},Boxer.prototype._wasPropertyInitialized=function(a){return!!Object.getOwnPropertyDescriptor(this,a)},Boxer.prototype._$$protect=function(){return new Proxy(this,{set:function(a,b,c){var d=0===b.indexOf("_$$"),e=a._wasPropertyInitialized(b);if(d)a[b]=c;else if(e&&!a._$$frozen)a.$set(b,c);else{if(!e||!a._$$frozen)throw console.trace(),"Cannot assign value ("+c+") to property ("+b+") which wasn't initialised, use $set or $initProperty methods to create new value";console.error("Boxer is frozen - to assign value to Boxer please unfreeze it first.",{boxer:a}),console.trace()}return!0}})},Boxer.prototype.$isProtected=function(){return this._$$protected},Boxer.prototype.$isMutable=function(){return!this._$$immutable},Boxer.prototype.$get=function(a){return"undefined"==typeof a?this._$$dataContainer:this._$$dataContainer.get(a)},Boxer.prototype.$set=function(a,b){if("_$$global"===a)console.error("_$$global is not allowed as a key because it is used as a wildcard event identifier"),console.trace();else if(this._$$frozen)console.error("Boxer is frozen - to assign value to Boxer please unfreeze it first.",{boxer:this}),console.trace();else{var c=this.$get(a),d=c!==b;this._$$immutable&&(this._$$dataContainer=new Map(this._$$dataContainer)),this._$$dataContainer.set(a,b),this.$initProperty(a),this._$$fireEventListeners(a,b,c,d)}return this},Boxer.prototype.$initProperty=function(a){var b=Object.getOwnPropertyDescriptor(this,a);return b&&b.get||Object.defineProperty(this,a,{get:function(){return this._$$dataContainer.get(a)},set:function(b){this.$set(a,b)},deleteProperty:function(){this.$delete(a)}}),this},Boxer.prototype._$$executeEvents=function(a,b,c,d,e){for(var f=a||[],g=f.length,h=0;h<g;h++)if(f[h]){var i=this._$$createEventObject(b,c,d,e,f[h]._$$eventListenerId);f[h](i)}return this},Boxer.prototype._$$createEventObject=function(a,b,c,d,e){return{keyOfTrigger:a,newValue:b,oldValue:c,valueChanged:d,eventListenerId:e}},Boxer.prototype._$$fireEventListeners=function(a,b,c,d){var e=this._$$eventListeners._$$global;this._$$executeEvents(e,a,b,c,d);var f=this._$$eventListeners[a];this._$$executeEvents(f,a,b,c,d)},Boxer.prototype.$delete=function(a){return delete this._$$dataContainer[a],this.$removeEventListener(a),this._$$immutable&&(this._$$dataContainer=new Map(this._$$dataContainer)),this._$$fireEventListeners(a),this},Boxer.prototype.$addEventListener=function(a,b){var c,d;if("function"!=typeof a||b?(c=a,d=b):(c="_$$global",d=a),"function"!=typeof d)return console.error("Invalid event listener type: ",typeof d),null;c in this._$$eventListeners||(this._$$eventListeners[c]=[]);var e=this._$$eventListeners[c];return d._$$eventListenerId=c+"."+e.length,this._$$eventListeners[c].push(d.bind(this)),d._$$eventListenerId},Boxer.prototype.$removeEventListener=function(a,b){var c="undefined"!=typeof a,d="undefined"!=typeof b;if(c&&d&&b in this._$$eventListeners[a])this._$$eventListeners[a][b]=null;else if(c)this._$$eventListeners[a].length=0;else if(b)for(var e in this._$$eventListeners)this._$$eventListeners[e].length=0;return this};