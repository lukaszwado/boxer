/*! Boxer 2016-09-02 */
"use strict";var Boxer=function(a,b,c,d){this._$$name=a||"",b&&this._$$register(this),this._$$dataContainer=new Map,this._$$eventListeners={"__*__":[]},this._$$immutable=this._$$booleanOrTrue(c),this._$$frozen=!1;var e=this._$$booleanOrTrue(d),f=this._$$isProxySupported();if(this._$$protected=f&&e,this._$$protected)return this._$$protect(this)};Boxer.prototype._$$boxerStore={nextFreeId:0,boxers:{}},Boxer.prototype.$getBoxerById=function(a){return this._$$boxerStore.boxers[a]||null},Boxer.prototype._$$register=function(a){var b="number"==typeof this._$$registeredId;return b?(console.error("Boxer already registered with id: "+this._$$registeredId,{boxer:this}),console.trace()):(this._$$boxerStore.boxers[this._$$boxerStore.nextFreeId]=a,this._$$registeredId=this._$$boxerStore.nextFreeId,this._$$boxerStore.nextFreeId++),this},Boxer.prototype.$getName=function(){return this._$$name},Boxer.prototype.$register=function(){return this.register(this),this},Boxer.prototype.$getId=function(){return this._$$registeredId||null},Boxer.prototype.$setName=function(a,b){return""===this._$$name?(this._$$name=a,b&&this._$$register(this)):console.log("Boxer cannot be renamed",{boxer:this}),this},Boxer.prototype._$$booleanOrTrue=function(a){return"boolean"!=typeof a||a},Boxer.prototype.$freeze=function(){return this._$$frozen=!0,this},Boxer.prototype.$unfreeze=function(){return this._$$frozen=!1,this},Boxer.prototype.$isFrozen=function(){return this._$$frozen},Boxer.prototype._$$isProxySupported=function(){return"undefined"!=typeof Proxy},Boxer.prototype._wasPropertyInitialized=function(a){return!!Object.getOwnPropertyDescriptor(this,a)},Boxer.prototype._$$protect=function(a){return new Proxy(a,{set:function(a,b,c){var d=0===b.indexOf("_$$"),e=a._wasPropertyInitialized(b);if(d)a[b]=c;else if(e&&!a._$$frozen)a.$set(b,c);else{if(!e||!a._$$frozen)throw console.trace(),"Cannot assign value ("+c+") to property ("+b+") which wasn't initialised, use $set or $initProperty methods to create new value";console.error("Boxer is frozen - to assign value to Boxer please unfreeze it first.",{boxer:a}),console.trace()}return!0}})},Boxer.prototype.$isProtected=function(){return this._$$protected},Boxer.prototype.$isMutable=function(){return!this._$$immutable},Boxer.prototype.$get=function(a){return"undefined"==typeof a?this._$$dataContainer:this._$$dataContainer.get(a)},Boxer.prototype.$set=function(a,b){if("__*__"===a)console.error("__*__ is not allowed as a key because it is used as a wildcard event identifier"),console.trace();else if(this._$$frozen)console.error("Boxer is frozen - to assign value to Boxer please unfreeze it first.",{boxer:this}),console.trace();else{var c=this.$get(a),d=c!==b;this._$$immutable&&(this._$$dataContainer=new Map(this._$$dataContainer)),this._$$dataContainer.set(a,b),this.$initProperty(a),this._$$fireEventListeners(a,b,c,d)}return this},Boxer.prototype.$initProperty=function(a){var b=Object.getOwnPropertyDescriptor(this,a);return b&&b.get||Object.defineProperty(this,a,{get:function(){return this._$$dataContainer.get(a)},set:function(b){this.$set(a,b)}}),this},Boxer.prototype._$$executeEvents=function(a,b,c,d,e,f){for(var g=a||[],h=g.length,i=0;i<h;i++)if(g[i]){var j=this._$$createEvent(b,c,d,e,f,this,g[i]);g[i](j)}return this},Boxer.prototype._$$createEvent=function(a,b,c,d,e,f,g){var h=this;return{keyOfTrigger:a,newValue:b,oldValue:c,valueChanged:d,trigger:e,stateElement:f,listenerFn:g,destroyEventListener:Boxer.prototype._$$removeEventListenerFactory(h._$$eventListeners[e],g)}},Boxer.prototype._$$fireEventListeners=function(a,b,c,d){var e=this._$$eventListeners["__*__"];this._$$executeEvents(e,a,b,c,d,"__*__");var f=this._$$eventListeners[a];this._$$executeEvents(f,a,b,c,d,a)},Boxer.prototype.$delete=function(a){return this.state.delete(a),this._$$immutable&&(this._$$dataContainer=new Map(this.state)),this._$$fireEventListeners(a),this},Boxer.prototype._$$removeEventListenerFactory=function(a,b){return function(){var c=a.indexOf(b),d=a.splice(c).splice(1);a.push.apply(a,d)}},Boxer.prototype.$addEventListener=function(a,b){var c=a,d=b;return"function"!=typeof c||d||(c="__*__",d=a),"function"!=typeof d?(console.error("Invalid event listener type: ",typeof d),null):(c in this._$$eventListeners||(this._$$eventListeners[c]=[]),this._$$eventListeners[c].push(d),this._$$removeEventListenerFactory(this._$$eventListeners[c],d))},Boxer.prototype.$removeEventListeners=function(a){if("undefined"!=typeof a)this._$$eventListeners[a].length=0;else for(var a in this._$$eventListeners)this._$$eventListeners[a].length=0;return console.log("$removeEventListeners",a,JSON.stringify(this._$$eventListeners)),this};